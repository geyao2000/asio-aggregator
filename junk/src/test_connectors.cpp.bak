TEST(BinanceConnectorTest, ParseSnapshot) {
    MockAggregator mock_agg;
    BinanceConnector connector(&mock_agg, "Binance");

    std::string msg = R"({
        "e": "depthUpdate",
        "E": 123456789,
        "s": "BTCUSDT",
        "U": 157,
        "u": 160,
        "b": [["70463.00","0.04"]],
        "a": [["70714.30","0.14"]]
    })";

    connector.parse_message(msg);

    EXPECT_EQ(connector.local_bids_.size(), 1);
    EXPECT_DOUBLE_EQ(connector.local_bids_[70463.00], 0.04);

    EXPECT_EQ(connector.local_asks_.size(), 1);
    EXPECT_DOUBLE_EQ(connector.local_asks_[70714.30], 0.14);
}